@model SmartBoard.Models.ExpedienteViewModalDetalle

@{
    int idtipo = ((int)ViewData["MyIdtipoObra"]);
    string titulo = (idtipo == 1 ? "Expedientes" : "Adquisiciones");


    ViewData["Title"] = titulo;
    //ViewData["PageName"] = "intel_records_dashboard";
    ViewData["PageName"] = "registro_" + titulo;
    ViewData["Category1"] = titulo;
    ViewData["Heading"] = "<i class='subheader-icon fal fa-chart-area'></i> Alta de <span class='fw-300'>" + @titulo + "</span>";

}

@section HeadBlock {
    @*<link id="mytheme" rel="stylesheet" media="screen, print" href="~/css/themes/cust-theme-13.css">*@
    <link rel="stylesheet" media="screen, print" href="~/css/fa-brands.css">
    <link rel="stylesheet" media="screen, print" href="~/css/formplugins/select2/select2.bundle.css">
            @if(idtipo != 1)
            {
                <link id="mytheme" rel="stylesheet" media="screen, print" href="~/css/themes/cust-theme-13.css">
            }
    <style>

        .btn-outline-default {
            background-color: black;
        }

        .ocultardescarga {
            display: none;
        }

        .mostrardescarga {
            display: initial;
        }

        .documentoDeshabilitado {
            display: none;
        }

        .documentoHabilitado {
            display: inline-flex;
        }

        .fileUpload {
            position: relative;
            overflow: hidden;
            /*margin: 10px;*/
        }

            .fileUpload input.upload {
                position: absolute;
                top: 0;
                right: 0;
                margin: 0;
                padding: 0;
                font-size: 20px;
                cursor: pointer;
                opacity: 0;
                filter: alpha(opacity=0);
            }

        .dot {
            height: 15px;
            width: 15px;
            border-radius: 50%;
            display: inline-block;
        }

        .dotgreen {
            background-color: green;
            height: 15px;
            width: 15px;
            border-radius: 50%;
            display: inline-block;
        }

        .dotred {
            background-color: red;
        }

        .dotyellow {
            background-color: yellow;
        }

        .dotgray {
            background-color: gray;
        }

        .dot_green {
            background-color: green;
            height: 15px;
            width: 15px;
            border-radius: 50%;
            display: inline-block;
        }

        .dot_red {
            background-color: red;
        }

        .dot_yellow {
            background-color: yellow;
        }

        .dot_gray {
            background-color: gray;
        }

        /* .clsObra {
                                            border-color: #E5E5E5 !important;
                                        }
                                */
        .clsObra {
            /*border-color: #E5E5E5 !important;*/
            border-color: #000000 !important;
        }

        .clsObraPorcentage {
            border-color: #E5E5E5 !important;
            background-color: white !important;
            color: black !important;
        }

        .divcontenedor {
            padding-left: 10px;
            height: 20px;
            overflow: hidden;
        }

        .divcontenedorlargo {
            width: 80% !important;
            /*padding-left:10px;*/
            height: 40px;
            overflow: hidden;
        }

        td {
            padding: 0.15em !important;
        }
    </style>

}

@section SubheaderBlock {
    <div class="subheader-block d-lg-flex align-items-center">
        <div class="d-flex mr-4">
            <div class="mr-2">
                <span class="peity-donut" data-peity="{ &quot;fill&quot;: [&quot;#967bbd&quot;, &quot;#ccbfdf&quot;],  &quot;innerRadius&quot;: 14, &quot;radius&quot;: 20 }">7/10</span>
            </div>
            <div>
                <label class="fs-sm mb-0 mt-2 mt-md-0">Nuevas Secciones</label>
                <h4 class="font-weight-bold mb-0">70.60%</h4>
            </div>
        </div>
        <div class="d-flex mr-0">
            <div class="mr-2">
                <span class="peity-donut" data-peity="{ &quot;fill&quot;: [&quot;#2196F3&quot;, &quot;#9acffa&quot;],  &quot;innerRadius&quot;: 14, &quot;radius&quot;: 20 }">3/10</span>
            </div>
            <div>
                <label class="fs-sm mb-0 mt-2 mt-md-0">Pagina Vista </label>
                <h4 class="font-weight-bold mb-0">14,134</h4>
            </div>
        </div>
    </div>
}




<div class="row">
    <div class="col-xl-12">
        <div id="panel-expediente" class="panel">

            <div class="panel-container show">
                <div class="panel-content">
                    <div id="DivNuevoExpediente">
                        @* <h5>Datos Generales</h5>*@
                        <div class="row">
                            <div class="col-md-12">
                                <form class="needs-validation" novalidate asp-action="EditExpediente" id="frmEditaObra">
                                    <input type="hidden" asp-for="Id" />
                                    <input type="hidden" asp-for="year" />
                                    <input type="hidden" asp-for="IdEjercicio" />
                                    <input type="hidden" asp-for="Region" />
                                    <input type="hidden" asp-for="IdtipoObra" />


                                    <div class="panel-content">
                                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                        <div class="form-group">
                                            <label asp-for="IdEjercicio" class="control-label">Ejercicio</label>
                                            <select asp-for="IdEjercicio" required disabled class="form-control  clsObra select2" asp-items="ViewBag.IdEjercicio"></select>
                                        </div>
                                        @if(idtipo == 1)
                                        {
                                            <div class="form-row">
                                                <div class="col-md-8 mb-3">
                                                    <label asp-for="Nombreobra" class="control-label">Nombre de Obra</label>
                                                    <input asp-for="Nombreobra" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="Nombreobra" class="text-danger"></span>
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label asp-for="Expediente" class="control-label"></label>
                                                    <input asp-for="Expediente" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="Expediente" class="text-danger"></span>

                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <label asp-for="folio" class="control-label"></label>
                                                    <input asp-for="folio" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="folio" class="text-danger"></span>

                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <input type="hidden" asp-for="Nombreobra" value="adjudicacion" />

                                            <div class="form-row">
                                                <div class="col-md-3 mb-3">
                                                    <label asp-for="ProveedorAdjudicado" class="control-label">Proveedor Adjudicado</label>
                                                    <input asp-for="ProveedorAdjudicado" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="ProveedorAdjudicado" class="text-danger"></span>
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label asp-for="EntidadRequiriente" class="control-label">Entidad Requiriente</label>
                                                    <input asp-for="EntidadRequiriente" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="EntidadRequiriente" class="text-danger"></span>
                                                </div>

                                                <div class="col-md-3 mb-3">
                                                    <label asp-for="Expediente" class="control-label">No. adjudicacion</label>
                                                    <input asp-for="Expediente" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="Expediente" class="text-danger"></span>

                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label asp-for="folio" class="control-label"></label>
                                                    <input asp-for="folio" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="folio" class="text-danger"></span>

                                                </div>
                                            </div>
                                        }
                                        @if(idtipo == 1)
                                        {
                                            <div class="form-row form-group">
                                                <div class="col-md-4 mb-4">
                                                    <label asp-for="BeneficiarioNombre" class="control-label"></label>
                                                    <input asp-for="BeneficiarioNombre" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="BeneficiarioNombre" class="text-danger"></span>
                                                </div>

                                                <div class="col-md-4 mb-4">
                                                    <label asp-for="EntidadEjecutora" class="control-label"></label>
                                                    <input asp-for="EntidadEjecutora" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="EntidadEjecutora" class="text-danger"></span>
                                                </div>

                                                <div class="col-md-4 mb-4">
                                                    <label asp-for="ContratistaNombre" class="control-label"></label>
                                                    <input asp-for="ContratistaNombre" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="ContratistaNombre" class="text-danger"></span>
                                                </div>

                                            </div>
                                        }

                                        @if(idtipo == 1)
                                        {
                                            <div class="form-row form-group">
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">

                                                    </span>
                                                    <label asp-for="EoPrograInicio" class="control-label"></label>
                                                    <input asp-for="EoPrograInicio" class="form-control clsObra" />
                                                    <label asp-for="EoPrograFin" class="control-label"></label>
                                                    <input asp-for="EoPrograFin" class="form-control clsObra" />
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">

                                                    </span>
                                                    <label asp-for="EoReprograInicio" class="control-label"></label>
                                                    <input asp-for="EoReprograInicio" class="form-control clsObra" />
                                                    <label asp-for="EoReprograFin" class="control-label"></label>
                                                    <input asp-for="EoReprograFin" class="form-control clsObra" />
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">

                                                    </span>
                                                    <label asp-for="EoRealInicio" class="control-label"></label>
                                                    <input asp-for="EoRealInicio" class="form-control clsObra" />
                                                    <label asp-for="EoRealFin" class="control-label"></label>
                                                    <input asp-for="EoRealFin" class="form-control clsObra" />
                                                </div>

                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">

                                                    </span>
                                                    <label asp-for="Ideje" class="control-label"></label>
                                                    <select asp-for="Ideje" class="custom-select clsObra select2" required asp-items="ViewBag.Ideje" aria-label="Select eje"> Selecciona Eje</select>
                                                </div>

                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">

                                                    </span>
                                                    <label asp-for="Idestrategia" class="control-label"></label>
                                                    <select asp-for="Idestrategia" class="custom-select clsObra select2" required asp-items="ViewBag.Idestrategia" aria-label="Select eje"> Selecciona Estrategia</select>
                                                </div>

                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">

                                                    </span>
                                                    <label asp-for="Idlineaaccion" class="control-label"></label>
                                                    <select asp-for="Idlineaaccion" class="custom-select clsObra select2" required asp-items="ViewBag.Idlineaaccion" aria-label="Select eje"> Selecciona Linea de Accion</select>
                                                </div>
                                            </div>
                                        }
                                        <div class="form-row form-group">

                                            <div class="col-md-2 mb-2">
                                                <span class="fa-2x d-inline l-h-n">

                                                </span>
                                                <label asp-for="Idregion" class="control-label"></label>
                                                <select asp-for="Idregion" class="custom-select clsObra select2" required asp-items="ViewBag.Idregion" aria-label="Select your country"> sleect algo</select>
                                            </div>
                                            <div class="col-md-2 mb-2">
                                                <span class="fa-2x d-inline l-h-n">

                                                </span>
                                                <label asp-for="Idmunicipio" class="control-label"></label>
                                                <select asp-for="Idmunicipio" class="custom-select clsObra select2" required asp-items="ViewBag.Idmunicipio"></select>
                                            </div>


                                            @if(idtipo == 1)
                                            {
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">

                                                    </span>
                                                    <label asp-for="Localidad" class="control-label"></label>
                                                    <input asp-for="Localidad" class="form-control clsObra" placeholder="Requerido*" required />
                                                    <span asp-validation-for="Localidad" class="text-danger"></span>

                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">

                                                    </span>
                                                    <label asp-for="Idzap" class="control-label"></label>
                                                    <select asp-for="Idzap" class="custom-select clsObra select2" required asp-items="ViewBag.Idzap"></select>
                                                </div>

                                                <div class="col-md-2 mb-3">

                                                    <span class="fa-2x d-inline l-h-n color-fusion-400">
                                                        <i class="fal fa-solid fa-map-marked-alt" id="getLocationGeo" style="color: black;"></i>
                                                    </span>
                                                    <label asp-for="Coordenadas" class="control-label"></label>
                                                    <input asp-for="Coordenadas" class="form-control clsObra" required />
                                                    <span asp-validation-for="Coordenadas" class="text-danger"></span>

                                                    <input asp-for="Coordenadax" class="form-control clsObra" required hidden />
                                                    <input asp-for="Coordenaday" class="form-control clsObra" required hidden />

                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">
                                                    </span>

                                                    <label class="control-label"> Avance</label>
                                                    <input asp-for="Porcentajeavance" class="form-control clsObra" required pattern="^\d*(\.\d{0,2})?$" /> % Fisico
                                                    <span asp-validation-for="Porcentajeavance" class="text-danger"></span>
                                                    <input asp-for="AvanceFinanciero" class="form-control clsObra" required pattern="^\d*(\.\d{0,2})?$" /> % Financiero
                                                    <span asp-validation-for="AvanceFinanciero" class="text-danger"></span>

                                                </div>
                                            }

                                        </div>

                                        <div class="form-row form-group">
                                            @if(idtipo == 1)
                                            {
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">
                                                    </span>
                                                    <label asp-for="Idgradomarginal" class="control-label"></label>
                                                    <select asp-for="Idgradomarginal" class="custom-select clsObra select2" required asp-items="ViewBag.Idgradomarginal" aria-label="Select your country"> sleect algo</select>
                                                </div>
                                            }
                                            <div class="col-md-2 mb-2">
                                                <span class="fa-2x d-inline l-h-n">
                                                </span>
                                                <label asp-for="IdnormativaAplicable" class="control-label"></label>
                                                <input type="hidden" asp-for="IdnormativaAplicable" />
                                                <select asp-for="IdnormativaAplicable" disabled class="custom-select clsObra select2" required asp-items="ViewBag.IdnormativaAplicable" aria-label="Select your country"> sleect algo</select>
                                            </div>
                                            @if(idtipo == 1)
                                            {
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">
                                                    </span>
                                                    <label asp-for="IdmodalidadEjecicion" class="control-label"></label>
                                                    <input type="hidden" asp-for="IdmodalidadEjecicion" />
                                                    <select asp-for="IdmodalidadEjecicion" disabled class="custom-select clsObra select2" required asp-items="ViewBag.IdmodalidadEjecicion"></select>
                                                </div>
                                                <div class="col-md-2 mb-2">
                                                    <span class="fa-2x d-inline l-h-n">
                                                    </span>
                                                    <label asp-for="Idcontratacion" class="control-label"></label>
                                                    <select asp-for="Idcontratacion" class="custom-select clsObra select2" required asp-items="ViewBag.Idcontratacion"></select>
                                                </div>
                                            }
                                            <div class="col-md-2 mb-2">
                                                <span class="fa-2x d-inline l-h-n">
                                                </span>
                                                <label asp-for="IdtipoAdjudicacion" class="control-label"></label>
                                                <input type="hidden" asp-for="IdtipoAdjudicacion" />
                                                <select asp-for="IdtipoAdjudicacion" disabled class="custom-select clsObra select2" required asp-items="ViewBag.IdtipoAdjudicacion"></select>
                                            </div>


                                            <div class="col-md-2 mb-2">
                                                <span class="fa-2x d-inline l-h-n">
                                                </span>
                                                <label asp-for="IdtipoContrato" class="control-label"></label>
                                                <select asp-for="IdtipoContrato" disabled class="custom-select clsObra select2" required asp-items="ViewBag.IdtipoContrato"></select>
                                            </div>


                                        </div>




                                        <div class="form-group">

                                            <button class="btn btn-primary" type="submit">Guardar</button>
                                        </div>
                                    </div>


                                    <div class="panel-container show">
                                        <div class="panel-content">

                                            <ul class="nav nav-pills nav-justified" role="tablist" style="border-bottom: 2px solid;">
                                                <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#js_change_pill_justified-1"> @(idtipo == 1 ? "Recursos" : "Contratos")</a></li>
                                                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#js_change_pill_justified-2">CheckList</a></li>
                                                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#js_change_pill_justified-3">Documentos por Proceso</a></li>
                                               
                                                @if (idtipo == 1)
                                                {
                                                     <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#js_change_pill_justified-4">Estimaciones/Facturas/Pagos</a></li>
                                                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#js_change_pill_justified-5">Catalogos</a></li>
                                                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#js_change_pill_justified-6">Finiquito</a></li>
                                                }
                                                else
                                                {
                                                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#js_change_pill_justified-7">Pagos</a></li>

                                                }
                                                @*<li class="nav-item"><a class="nav-link" data-toggle="tab" href="#js_change_pill_justified-8">Fotos</a></li>*@

                                            </ul>

                                            <div class="tab-content py-3">

                                                <div class="tab-pane fade show active" id="js_change_pill_justified-1" role="tabpanel">
                                                    @if (idtipo == 1)
                                                    {
                                                        <partial name="~/Views/TblObras/Recursos.cshtml" />
                                                    }
                                                    else
                                                    {
                                                        <partial name="~/Views/TblObras/Contrato.cshtml" />
                                                    }
                                                </div>

                                                <div class="tab-pane fade" id="js_change_pill_justified-2" role="tabpanel">
                                                    <partial name="~/Views/TblObras/CheckList.cshtml" />

                                                </div>


                                                <div class="tab-pane fade" id="js_change_pill_justified-3" role="tabpanel">

                                                    <partial name="~/views/tblobras/DocumentosProceso.cshtml" />
                                                </div>


                                                

                                                @if(idtipo == 1)
                                                {
                                                    <div class="tab-pane fade" id="js_change_pill_justified-4" role="tabpanel">
                                                    <partial name="~/Views/TblObras/DocumentosFacturas.cshtml" />
                                                </div>

                                                    <div class="tab-pane fade" id="js_change_pill_justified-5" role="tabpanel">
                                                        <partial name="~/Views/TblObras/DocumentosCatalogos.cshtml" />
                                                    </div>

                                                    <div class="tab-pane fade" id="js_change_pill_justified-6" role="tabpanel">
                                                        <partial name="~/Views/TblObras/DocumentosFiniquito.cshtml" />
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="tab-pane fade" id="js_change_pill_justified-7" role="tabpanel">
                                                        <partial name="~/views/tblobras/DocumentosPagos.cshtml" />
                                                    </div>
                                                }

                                               @*   <div class="tab-pane fade" id="js_change_pill_justified-8" role="tabpanel">

                                                    <partial name="~/views/tblobras/DocumentosFotos.cshtml" />
                                                </div>*@



                                            </div>

                                        </div>
                                    </div>
                                    <div class="panel-container show">
                                        <div class="panel-content">
                                            <div class="form-group">

                                                @*<button class="btn btn-primary" type="submit">Continuar</button>*@
                                            </div>
                                        </div>

                                    </div>

                                </form>
                            </div>
                        </div>

                    </div>

                </div>
            </div>

        </div>
    </div>
</div>


<div class="modal fade" id="default-example-modal-sm" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Rechazo - Documento</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="@(Settings.Theme.IconPrefix) fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="id_ref_doc" name="id_ref_doc" />
                <label class="control-label">
                    Observaciones
                </label>
                <input type="text" id="id_ref_proceso" class="form-control clsObra" name="id_ref_proceso" />

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="guardarObservacion()">Guardar Cambios</button>
            </div>
        </div>
    </div>
</div>


@*<div>
        <a asp-action="Index">Back to List</a>
    </div>*@


@section ScriptsBlock {
    <script src="~/js/statistics/peity/peity.bundle.js"></script>
    <script src="~/js/statistics/flot/flot.bundle.js"></script>
    <script src="~/js/statistics/easypiechart/easypiechart.bundle.js"></script>
    <script src="~/js/datagrid/datatables/datatables.bundle.js"></script>
    <script src="~/js/formplugins/select2/select2.bundle.js"></script>
    <script src="~/js/obras/expediente.js"></script>

    <script type="text/javascript">

        $("#openModalCrearCampo").click(function () {
            $("#modalCrearCampo").modal("show");
        });

        function CambioObservacion(id) {
            $('#id_ref_doc').val(id);
            $('#default-example-modal-sm').modal('show');

        }

        function CambioAprobacion(id) {

            if ($('#chkaproba_id_' + id).is(":checked")) {
                guardarAprobacion(id);
            }


        }

        function guardarAprobacion(id) {


            $.ajax({
                url: '@Url.Action("guardarAprobacion", "TblObras")?id=' + id, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                success: function (result) {
                    if (result == '1') {
                        alert("Observación asignada correctamente");


                        $("#bandera_id_" + id).removeClass("dot_yellow");
                        $("#bandera_id_" + id).addClass("dot_green");
                        location.reload();

                        //location.reload(false)
                    } else {
                        alert('No se pudo borrar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }




        function guardarObservacion() {

            var id = $('#id_ref_doc').val();
            var obs = $('#id_ref_proceso').val();

            $.ajax({
                url: '@Url.Action("ObservacionArchivo", "TblObras")?id=' + id + '&observacion=' + obs, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                success: function (result) {
                    if (result == '1') {
                        alert("Observación asignada correctamente");
                        //$('#default-example-modal-sm').modal('close');
                        //$("#descarga_id_" + id).removeClass("mostrardescarga");
                        //$("#descarga_id_" + id).addClass("ocultardescarga");

                        //$("#borrar_id_" + id).removeClass("mostrardescarga");
                        //$("#borrar_id_" + id).addClass("ocultardescarga");


                        //$("#mostrar_id_" + id).removeClass("mostrardescarga");
                        //$("#mostrar_id_" + id).addClass("ocultardescarga");

                        //$("#aprobado_id_" + id).removeClass("mostrardescarga");
                        //$("#aprobado_id_" + id).addClass("ocultardescarga");

                        $("#bandera_id_" + id).removeClass("dot_yellow");
                        $("#bandera_id_" + id).addClass("dot_red");
                        location.reload();

                        //location.reload(false)
                    } else {
                        alert('No se pudo borrar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }


        function BorrarArchivo(id) {




            $.ajax({
                url: '@Url.Action("BorrarArchivo", "TblObras")?id=' + id, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                success: function (result) {
                    if (result == '1') {
                        alert("Archivo borrado correctamente");
                        $("#descarga_id_" + id).removeClass("mostrardescarga");
                        $("#descarga_id_" + id).addClass("ocultardescarga");

                        $("#borrar_id_" + id).removeClass("mostrardescarga");
                        $("#borrar_id_" + id).addClass("ocultardescarga");


                        $("#mostrar_id_" + id).removeClass("mostrardescarga");
                        $("#mostrar_id_" + id).addClass("ocultardescarga");

                        $("#aprobado_id_" + id).removeClass("mostrardescarga");
                        $("#aprobado_id_" + id).addClass("ocultardescarga");

                        $("#cambio_id_" + id).removeClass("mostrardescarga");
                        $("#cambio_id_" + id).addClass("ocultardescarga");

                        $("#bandera_id_" + id).removeClass("dot_yellow");
                        $("#bandera_id_" + id).addClass("dot_red");

                        //location.reload(false)
                    } else {
                        alert('No se pudo borrar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }



        function BorrarArchivoName(id, file) {




            $.ajax({
                url: '@Url.Action("BorrarArchivoName", "TblObras")?id=' + id + '&file=' + file, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                success: function (result) {
                    if (result == '1') {
                        alert("Archivo borrado correctamente");
                        $("#descarga_id_" + id).removeClass("mostrardescarga");
                        $("#descarga_id_" + id).addClass("ocultardescarga");

                        $("#borrar_id_" + id).removeClass("mostrardescarga");
                        $("#borrar_id_" + id).addClass("ocultardescarga");


                        $("#mostrar_id_" + id).removeClass("mostrardescarga");
                        $("#mostrar_id_" + id).addClass("ocultardescarga");

                        $("#aprobado_id_" + id).removeClass("mostrardescarga");
                        $("#aprobado_id_" + id).addClass("ocultardescarga");

                        $("#cambio_id_" + id).removeClass("mostrardescarga");
                        $("#cambio_id_" + id).addClass("ocultardescarga");

                        $("#bandera_id_" + id).removeClass("dot_yellow");
                        $("#bandera_id_" + id).addClass("dot_red");

                        $('#divdocumento_' + id).load('@Url.Action("getArchivos", "TblObras")?iddoc=' + id);
                        //location.reload(false)
                    } else {
                        alert('No se pudo borrar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }


        function BorrarArchivoEVFactura(id, file) {

            $.ajax({
                url: '@Url.Action("BorrarArchivoFactura", "TblObras")?id=' + id + '&file=' + file, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                success: function (result) {
                    if (result == '1') {
                        alert("Archivo borrado correctamente");


                        $('#divEVFactura_' + id).load('@Url.Action("getArchivosEVFactura", "TblObras")?iddoc=' + id);
                        //location.reload(false)
                    } else {
                        alert('No se pudo borrar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }

        function BorrarArchivoEvidencia(id, file) {

            $.ajax({
                url: '@Url.Action("BorrarArchivoEvidencia", "TblObras")?id=' + id + '&file=' + file, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                success: function (result) {
                    if (result == '1') {
                        alert("Archivo borrado correctamente");



                        $('#divEVEvidencia_' + id).load('@Url.Action("getArchivosEvidencia", "TblObras")?iddoc=' + id);
                        //location.reload(false)
                    } else {
                        alert('No se pudo borrar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }



        function SubirArchivo(id, noObra, idObra) {

            var fileUpload = $("#files_" + id).get(0);
            var files = fileUpload.files;
            var fileData = new FormData();

            // if there are multiple files , loop through each files
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }
            fileData.append('IdDocObra', noObra);
            fileData.append('IdObra', idObra);
            fileData.append('IdDoc', id);




            $.ajax({
                url: '@Url.Action("UploadFiles", "TblObras")?id=' + id, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                data: fileData,
                success: function (result) {
                    if (result == '1') {
                        alert("Archivo cargado correctamente");
                        $("#descarga_id_" + id).removeClass("ocultardescarga");
                        $("#descarga_id_" + id).addClass("mostrardescarga");

                        $("#borrar_id_" + id).removeClass("ocultardescarga");
                        $("#borrar_id_" + id).addClass("mostrardescarga");


                        $("#mostrar_id_" + id).removeClass("ocultardescarga");
                        $("#mostrar_id_" + id).addClass("mostrardescarga");

                        $("#aprobado_id_" + id).removeClass("ocultardescarga");
                        $("#aprobado_id_" + id).addClass("mostrardescarga");

                        $("#cambio_id_" + id).removeClass("ocultardescarga");
                        $("#cambio_id_" + id).addClass("mostrardescarga");

                        $("#bandera_id_" + id).removeClass("dot_red");
                        $("#bandera_id_" + id).addClass("dot_yellow");

                        $('#divdocumento_' + id).load('@Url.Action("getArchivos", "TblObras")?iddoc=' + id);

                        //location.reload(false)
                    } else {
                        alert('No se pudo cargar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }



        function SubirArchivoEFactura(id, noObra, idObra) {

            var fileUpload = $("#files_" + id).get(0);
            var files = fileUpload.files;
            var fileData = new FormData();

            // if there are multiple files , loop through each files
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }
            fileData.append('IdDocObra', noObra);
            fileData.append('IdObra', idObra);
            fileData.append('IdDoc', id);




            $.ajax({
                url: '@Url.Action("UploadFilesEVFactura", "TblObras")?id=' + id, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                data: fileData,
                success: function (result) {
                    if (result == '1') {
                        alert("Archivo cargado correctamente");


                        $('#divEVFactura_' + id).load('@Url.Action("getArchivosEVFactura", "TblObras")?iddoc=' + id);

                        //location.reload(false)
                    } else {
                        alert('No se pudo cargar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }


        function SubirArchivoEvidencia(id, noObra, idObra) {

            var fileUpload = $("#files_" + id).get(0);
            var files = fileUpload.files;
            var fileData = new FormData();

            // if there are multiple files , loop through each files
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }
            fileData.append('IdDocObra', noObra);
            fileData.append('IdObra', idObra);
            fileData.append('IdDoc', id);




            $.ajax({
                url: '@Url.Action("UploadFilesEvidencia", "TblObras")?id=' + id, //URL to upload files
                type: "POST", //as we will be posting files and other method POST is used
                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error
                contentType: false,
                data: fileData,
                success: function (result) {
                    if (result == '1') {
                        alert("Archivo cargado correctamente");


                        $('#divEVEvidencia_' + id).load('@Url.Action("getArchivosEvidencia", "TblObras")?iddoc=' + id);

                        //location.reload(false)
                    } else {
                        alert('No se pudo cargar el documento ...');
                    }
                    /*alert(result);*/
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        }


        $("#getLocationGeo").click(function () {

            getLocation();
        });

        function getLocation() {

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                $("#Coordenadas").val("Geolocation is not supported by this browser.");
            }
        }

        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {

            'use strict';
            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>

    <script>
        $(function () {

            $('.divdocumento').each(function () {
                var currentElement = $(this).attr('myid');
                var valueid = currentElement;
                $('#divdocumento_' + valueid).load('@Url.Action("getArchivos", "TblObras")?iddoc=' + valueid);

            });

            $('.divEVFactura').each(function () {
                var currentElement = $(this).attr('myid');
                var valueid = currentElement;
                $('#divEVFactura_' + valueid).load('@Url.Action("getArchivosEVFactura", "TblObras")?iddoc=' + valueid);


            });


            $('.divEVEvidencia').each(function () {
                var currentElement = $(this).attr('myid');
                var valueid = currentElement;

                $('#divEVEvidencia_' + valueid).load('@Url.Action("getArchivosEvidencia", "TblObras")?iddoc=' + valueid);


            });



        @*var urlVertiente = '@Url.Action("FetchVertientes", "TblObras")';
            fillDDL(urlVertiente, "Idvertiente", "--- Selecciona Vertiente ---");


            var urlSubVertiente = '@Url.Action("FetchSubVertientes", "TblObras")?idVertiente=0';
            fillDDL(urlSubVertiente, "Idsubvertiente", "--- Selecciona Sub Vertiente ---");*@

        @*
            Usar despues y mejorarel FillDDL
            var urlSubVertiente = '@Url.Action("FetchSubVertientes", "TblObras")?idVertiente='+@Model.Idvertiente;
            fillDDL(urlSubVertiente, "Idsubvertiente", "--- Selecciona Sub Vertiente ---");*@


                $("#Idvertiente").change(function () {
                    var Idvertiente = $("#Idvertiente option:selected").val();
                    var url = '@Url.Action("FetchSubVertientes", "TblObras")?idVertiente=' + Idvertiente;
                    fillDDL(url, "Idsubvertiente", "--- Selecciona Sub Vertiente ---");

                });



            $("#idprocentagefederal").val(($("#InversionFederal").val() / $("#Inversion").val()) * 100);
            $("#idprocentageEstatal").val(($("#InversionEstatal").val() / $("#Inversion").val()) * 100);
            $("#idprocentageMunicipal").val(($("#InversionMunicipal").val() / $("#Inversion").val()) * 100);
            $("#idprocentageCiudadano").val(($("#InversionBeneficiario").val() / $("#Inversion").val()) * 100);


            $("#Inversion").change(function () {

                $("#InversionFederal").val($("#Inversion").val());
                $("#InversionEstatal").val(0);
                $("#InversionMunicipal").val(0);
                $("#InversionBeneficiario").val(0);

                calcularPorcentaje();
            });




            $("#InversionFederal").change(function () {
                calcularPorcentaje();
            });
            $("#InversionEstatal").change(function () {
                calcularPorcentaje();
            });
            $("#InversionMunicipal").change(function () {
                calcularPorcentaje();
            });
            $("#InversionBeneficiario").change(function () {
                calcularPorcentaje();
            });

            function calcularPorcentaje() {
                $("#idprocentagefederal").val(0);
                $("#idprocentageEstatal").val(0);
                $("#idprocentageMunicipal").val(0);
                $("#idprocentageCiudadano").val(0);

                $("#idprocentagefederal").val(($("#InversionFederal").val() / $("#Inversion").val()) * 100);
                $("#idprocentageEstatal").val(($("#InversionEstatal").val() / $("#Inversion").val()) * 100);
                $("#idprocentageMunicipal").val(($("#InversionMunicipal").val() / $("#Inversion").val()) * 100);
                $("#idprocentageCiudadano").val(($("#InversionBeneficiario").val() / $("#Inversion").val()) * 100);

            }


            //$('.select2').select2();




            $("#Idregion").change(function () {
                var idregion = $("#Idregion option:selected").val();
                var url = '@Url.Action("FetchMunucipios", "TblObras")?idregion=' + idregion;
                fillDDL(url, "Idmunicipio", "--- Selecciona Municipio ---");

            });

            $("#Idmunicipio").change(function () {
                var idmunicipio = $("#Idmunicipio option:selected").val();

                var urllocalidad = '@Url.Action("FetchLocalidades", "TblObras")?urllocalidad=' + idmunicipio;
                fillDDL(urllocalidad, "Idlocalidad", "--- Selecciona Localidad ---");


            });




        @if (Model.Idestrategia == null)
        {
            <text>
                                                                   var urlEstrategia = '@Url.Action("FetchEstrategia", "TblObras")?ideje=' + 0;
                fillDDL(urlEstrategia, "Idestrategia", "--- Selecciona Estrategia ---");


            </text>
        }


        @if (Model.Idlineaaccion == null)
        {
            <text>
                                                     var urlIdlineaaccion = '@Url.Action("FetchLineaAccion", "TblObras")?idestrategia=' + 0;
                fillDDL(urlIdlineaaccion, "Idlineaaccion", "--- Selecciona Linea de Accion ---");


            </text>
        }





                $("#Ideje").change(function () {
                    var Ideje = $("#Ideje option:selected").val();

                    var urlEstrategia = '@Url.Action("FetchEstrategia", "TblObras")?ideje=' + Ideje;
                    fillDDL(urlEstrategia, "Idestrategia", "--- Selecciona Estrategia ---");
                    $("#Idestrategia").change();

                });


            $("#Idestrategia").change(function () {
                var Idestrategia = $("#Idestrategia option:selected").val();
                var urlIdlineaaccion = '@Url.Action("FetchLineaAccion", "TblObras")?idestrategia=' + Idestrategia;
                fillDDL(urlIdlineaaccion, "Idlineaaccion", "--- Selecciona Linea de Accion ---");

            });


            $("input[type=checkbox]").click(function () {
                //alert($(this).attr('class'));
                //    alert($(this).attr('id'));

                var estaClase = $(this).attr('grupo');
                //alert(estaClase);
                if (estaClase.length != 0) {


                    if (!$(this).prop("checked")) {
                        $('.' + estaClase).prop("checked", false);
                    } else {
                        $('.' + estaClase).prop("checked", true);
                    }
                }
                //if (!$(this).prop("checked")) {
                //    $("#selectAll").prop("checked", false);
                //}
            });


        })
    </script>
}
